#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'rperf'

class App
  include Methadone::Main
  include Methadone::CLILogging
  include Methadone::SH

  main do |files| # Add args you want: |like,so|
    # your program code here
    # You can access CLI options via
    # the options Hash
  end

  description "IO performance testing utility"

  on "--workload WORKLOADS", "-w", "Specifies the workload or workloads to use for the test"

  arg :FILE_OR_DEVICE, :required, :many, 
    <<EOF
File or device to read and write, along with an optional size
	specification.  By default, rperf will use the entire size of the
	device. Multiple files or devices may be specified.

	Examples: 

	1) 'rperf /dev/sdb' will perform IO to the entire range of block
           offsets within the /dev/sdb device, 

	2) 'rperf myfile$5G' will perform IO to the first 5 GiB of the file
	   'myfile' regardless of it's current size." 
EOF

  version Rperf::VERSION

  use_log_level_option

  go!
end

# all workloads applied to all devices?
# range within the file?
#
# For each workload, must specify
# - target device
# - range within the target
# - IO streams: random/sequential, block size, #threads, for writes: dedupe rate, compressibility
#
# rspec "/dev/sdb{0-50GiB} = r-8KiB-10, w-128KiB-1@50-2" "/dev/sdc = w-2048-2"
